<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Tags on I hope it lasts longer than I could have thought</title>
    <link>https://alanli.org/tags/</link>
    <description>Recent content in Tags on I hope it lasts longer than I could have thought</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-US</language>
    
	<atom:link href="https://alanli.org/tags/index.xml" rel="self" type="application/rss+xml" />
    
    
    
    <item>
      <title>关于中国式教育 Chinese Education</title>
      <link>https://alanli.org/%E5%85%B3%E4%BA%8E%E4%B8%AD%E5%9B%BD%E5%BC%8F%E6%95%99%E8%82%B2-chinese-education/</link>
      <pubDate>Mon, 16 Jan 2023 21:32:30 -0800</pubDate>
      
      <guid>https://alanli.org/%E5%85%B3%E4%BA%8E%E4%B8%AD%E5%9B%BD%E5%BC%8F%E6%95%99%E8%82%B2-chinese-education/</guid>
      <description>&lt;p&gt;东亚极低的出生率有很大的一部分是因为东亚家庭对下一代教育有着极高要求，但是这样的要求“高”的并不代表“好”。&lt;/p&gt;
&lt;p&gt;以我的成长经历来看，身边大多数的父母根本不在意学校里面教了什么内容，只要我家儿子闺女的分数上去了就是好的。东亚的父母比谁都更加注重孩子的分数，因为分数代表了竞争的排名；而排名又决定了能进入的学校的好坏，学校的好坏又直接决定了毕业后的工作去向。所以说归根结底，父母们关注的是下一代毕业之后到底能稳定地赚到多少钱，能给这个大家庭带来多大的利益。至于学到了什么，有没有用，并不是需要关心的问题。这个简单粗暴的想法在金钱决定论盛行的中国和韩国是显而易见得实用，毕竟这个社会卷得狠。&lt;/p&gt;
&lt;p&gt;虽然口头上说的是“为了下一代”，但是功利主义的风气如此盛行的地方，绝大多数的父母到头来都会失望的，因为能够得到社会认可的教育资源极度缺乏。以985大学为例，全国每年能进入985大学的学生&lt;a href=&#34;https://www.163.com/dy/article/FS4FHTTJ053696V7.html&#34;&gt;仅不到2%&lt;/a&gt;，211大学也只有5%左右。假如腾讯，华为和阿里只招985/211的学生的话，他们被仰望是再正常不过的了，毕竟确实是少数人才能达到的高度。不过呢，即使谁家孩子天生资质好进了985大学，毕业几年后父母可能还要再失望一次。因为即使是top 2%的学生，在北上广深杭来说还是太多了。到头来老人们可能不得不把养老的积蓄拿出来给在大城市当人矿的孩子们结婚买房。回头来看，这似乎是一个再南辕北辙不过的事情了：想要下一代有出息能够带来多少利益，没想到两代人矿都进了某个早就设定好的套里面。&lt;/p&gt;
&lt;p&gt;在我的想法里面，中国的学校，不管有多好，都只在教一些你多半不会用到的知识，没有教会理解世界上的美&amp;mdash;后者反而是生存更重要的工具，那个避免让人变成人矿，韭菜的工具。&lt;/p&gt;
&lt;p&gt;亚里士多德推崇美(virtue，常被译为美德，但我认为这样的翻译狭隘了它的本意)，他认为美是人天生会向往和追求的东西。这一点我不能同意更多：我们一生都愿意见到美的东西，而不愿意见到丑的东西，我相信这是根植在人性深处的本能。道德也是一样：善是美的，有秩序的；恶是丑的，混沌的。所以我们天生喜欢善，嫌弃恶。&lt;/p&gt;
&lt;p&gt;对美的追求我们天生就有，教这些规则也用不着非得去一流的学校。也许爸妈饭桌上的几句话，周末的一次远足，科学馆的一个下午就可以产生足够的临界动能，让一个孩子的脑海里小小的火花变成灿烂的烟火，而这个烟火很可能可以改变自己也可以改变世界。&lt;/p&gt;
&lt;p&gt;可是现代生活太忙碌了，很多人连和孩子一起吃晚饭都是奢望。如果真是这样的话，那就不能怪他们长大之后跟爹妈不亲近了。意大利人把晚餐当作一天家庭聚会最重要的时刻，出去应酬简直是浪费了一家人在一起的最好时光。就像Pixar电影Inside Out一样，美好的时光是脑海里面闪闪发光的玻璃球，没有了他们，人就变得暗淡，眼里没有光。会和冰冷的数字，功利的算计为伍，久而久之变成一个没意思的人。说实话的，这时我们就不能不负责任地够怪教育制度了，因为教育应该首先来自父母。如果父母本来就是一个功利的人，那必定会功利地要求下一代，然后下一代就会继续功利地要求后代&amp;mdash;世世代代都在那个预先设好的套里面做人矿。&lt;/p&gt;
&lt;p&gt;我看张益唐的视频，他年岁已高，手已然开始颤抖。但当他拄着拐杖上讲台拿起粉笔在黑板上开始写公式的时候，他的眼里开始有光，变成了一个年轻人。他和一般人不一样，他说：“我只要有钱就足够花”。这句话实在太有深意，我时常不自觉地。我想，他正是因为这样，才活得比别人精彩吧。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;（附）
以下是日本针对少子化问题的简单研究总结：
&lt;blockquote class=&#34;twitter-tweet&#34;&gt;&lt;p lang=&#34;zh&#34; dir=&#34;ltr&#34;&gt;2008年日本就明白的问题，现在也没啥好办法。&lt;br&gt;中译：&lt;br&gt;・土地价格上涨会导致出生率下降&lt;br&gt;・家庭越重视教育越会导致出生率下降&lt;br&gt;・提高女性收入/就业率会间接导致出生率下降&lt;br&gt;・收入的增加只会提升儿童的平均教育水平&amp;amp;支出，不会增加出生率&lt;br&gt;・儿童补贴对出生率没有影响。&lt;br&gt;・增加托儿所有一点效果，但开销大 &lt;a href=&#34;https://t.co/hQriHk88zm&#34;&gt;https://t.co/hQriHk88zm&lt;/a&gt;&lt;/p&gt;&amp;mdash; 凡 (@fan_renewal) &lt;a href=&#34;https://twitter.com/fan_renewal/status/1611167707478773761?ref_src=twsrc%5Etfw&#34;&gt;January 6, 2023&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async src=&#34;https://platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;
&lt;/p&gt;
</description>
    </item>
    
    
    
    <item>
      <title>轮回和重生 Samsara and a new Incarnation</title>
      <link>https://alanli.org/%E8%BD%AE%E5%9B%9E%E5%92%8C%E9%87%8D%E7%94%9F-samsara-and-a-new-incarnation/</link>
      <pubDate>Sat, 14 Jan 2023 20:34:20 -0800</pubDate>
      
      <guid>https://alanli.org/%E8%BD%AE%E5%9B%9E%E5%92%8C%E9%87%8D%E7%94%9F-samsara-and-a-new-incarnation/</guid>
      <description>&lt;p&gt;“轮回/Samsara”是个影响深远的信念，宗教上它给虚无(nihilistic)，冷漠(indifferent)的世界赋予了流转的生命力，让世界有了意义。它同时又以超验的形式解释了人往生的后的因果由来，将每一段生命连接在一起，人的生命因此而有意义和目标。&lt;/p&gt;
&lt;p&gt;也许这个概念最初被创建时，是人类想用有限的理解，去解释无尽的时间线上的世界是如何运转的。到现在为止，人类都无法有把握地去猜测时间的最初和尽头各是什么样的。宇宙也有轮回吗？谁知道呢，我相信这是超越我们认知范围的知识(transcendental knowledge)。作为一个不可知论者(agnostic)，无论造物主是否真的存在，我都希望宇宙，及每一个事物的可感知的终点都不是最终的归宿。这样，每当想起“我们最终都会死的”（即使是出现在脱口秀中）这句话时，心里不会那么地有无力感。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;轮回并不仅仅存在于佛教社会里，近东的犹太人早在两三千年前就已经将其实践于世俗生活中。虽然上帝的子民相信时间有起点也有终点，但每隔七七四十九年，犹太社会就会迎来一个“禧年(Jubilee)”。圣经《利未记》上说，在这一年中囚犯和奴隶将被赦免，所欠的债全部免清，（利未城的）土地被赎回。&lt;/p&gt;
&lt;p&gt;我们暂且不说这样的规定操作性如何，但上帝的这道旨意即使放到今天也是无比地超前，似乎具有穿透历史的深远意义。七七四十九年，社会被重置，回到起点完成一个轮回，如此往复，在线性时间轴上完成了另一种形式的轮回。&lt;/p&gt;
&lt;p&gt;欧亚大陆另一侧的东土中原，轮回则残酷得多。“王侯将相，宁有种乎“，每一次朝代更替带来的都是生灵涂炭。然而分久必合，合久必分，短则十几几十年，长则两三百年，这块土地又会遭遇血洗，代价高昂地如是反复。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;我在小的时候经常被人叫去修电脑。早期的电脑软件稳定性远不如现在，兼容机经常死机。大部分的电脑问题，都可以通过重启动或者是重装驱动/软件来解决。至于是什么原因&amp;ndash;计算机是复杂工程，大概没人能说得清。以混沌系统来做类比的话，电脑运行久了，（那些内存泄漏或者是驱动bug写错buffer之类的）产生的熵就达到无法维持继续运转的程度，此时重启或者重装是唯一的解决方案。&lt;/p&gt;
&lt;p&gt;任何系统都有熵，社会运转的熵从哪里来？史书上写前朝末年通常就是政治腐败，民不聊生。财政崩溃，兵荒马乱都是社会运转出现了不可逆转的问题。这些熵是怎么积累的？&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;大富翁/Monopoly是为了教育小朋友们分配制度而设计的，看名字就知道。但是因为太好玩了，经久不衰，反而有点失去了原来的意义。大富翁想要告诉我们的是：在现有看似公平的规则下，无论一开始有多少玩家，最终游戏结束时总是会达到一个人的垄断。&lt;/p&gt;
&lt;p&gt;其中还有一些有趣的点，比如：和别的智力游戏不同，玩家的策略就只需要是见到空的土地就买和能盖楼就盖楼，所以即使是玩家的初始资金相同，成功大部分都是靠运气而不是靠实力；又比如有意思的是，垄断是个极其稳定状态，是整个游戏过程里面最稳定的状态。&lt;/p&gt;
&lt;p&gt;大富翁形象地揭示了一个社会财富分配规律：无论每个人初始条件如何，最终达到的社会累积财富分配遵循幂法则。即帕累托分布（Pareto&amp;rsquo;s Distribution），俗称马太效应。这个结论最有意思的地方是：”无论每个人初始条件如何“。我们可以把财富分配的不平均度（基尼系数）当作这个系统的熵，它会是不可逆的。&lt;/p&gt;
&lt;p&gt;基尼系数高的国家，不论是民主制还是独裁制，都是政治腐败，民生穷困，社会成本高昂，缺乏内在动力，无法进行复杂的社会生产。一百二十年前，阿根延是世界上最富有的国家；一百二十年后，大家都在避免成为下一个阿根延，但是似乎这样的努力的终点仍然是按下痛苦的重置键。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;遥远的两千五百年前，利未城的犹太人或许就是在主动地按下重置键来避免痛苦的重生之旅。若真是这样，谁能不相信他们就是上帝的子民呢？&lt;/p&gt;
</description>
    </item>
    
    
    
    
    
    <item>
      <title>普适价值 Are there universal values?</title>
      <link>https://alanli.org/%E6%99%AE%E9%80%82%E4%BB%B7%E5%80%BC-are-there-universal-values/</link>
      <pubDate>Mon, 02 Jan 2023 16:57:34 -0800</pubDate>
      
      <guid>https://alanli.org/%E6%99%AE%E9%80%82%E4%BB%B7%E5%80%BC-are-there-universal-values/</guid>
      <description>&lt;p&gt;假如真的有外星人存在，那么远在千万光年之遥的他们，会是以一个什么样的形式存在？&lt;/p&gt;
&lt;p&gt;Paul Graham在&lt;a href=&#34;http://www.paulgraham.com/alien.html&#34;&gt;Alien Truth&lt;/a&gt;简单探讨了这个问题：他们一定会和我们一样知道1+1=2，知道宇宙的分子重量，知道如何用科学的方法实验和建立模型。Carl Sagan也同样认为如果有外星生命，他们也会和我们一样会用数学去理解世间运行的逻辑。&lt;/p&gt;
&lt;p&gt;我完全同意这样的看法，因为在人类数千年发展的历史中，科学是（迄今为止）最有效的认识世界的发展方式。在当下这个时代，人类仅仅离可控核聚变大规模应用只差了那么一点点。如果一切顺利，我们的征途终将是星辰大海，地球会变成人类遥远的故乡。我们有理由相信，所有的智慧生命都能够理解并应用科学来让自己的生活变得更好。&lt;/p&gt;
&lt;p&gt;但是我还好奇更多关于他们的生活。他们是否也是社会性的？如果是，是否也有道德观？如果是，是否和我们的相近，比如规定不能杀死同类？我们无法知道确切的答案，但是我们能够用无限的想象力去猜测在异星上的他们的生活。&lt;/p&gt;
&lt;p&gt;在狂野幻想之前先要有一个presupposition,首先，如果没有一个具体的造物主，一个智慧文明很有是从极简单的生物体发展而来的，也不会有任何超验的知识存在，正如人类一样，生存的一切靠自己。于是人类生存和发展的经验完全可以拿来类比。&lt;/p&gt;
</description>
    </item>
    
    
    
    <item>
      <title>交易费用经济 Transaction Fees</title>
      <link>https://alanli.org/%E4%BA%A4%E6%98%93%E8%B4%B9%E7%94%A8%E7%BB%8F%E6%B5%8E-transaction-fees/</link>
      <pubDate>Tue, 21 Aug 2018 08:59:26 +0000</pubDate>
      
      <guid>https://alanli.org/%E4%BA%A4%E6%98%93%E8%B4%B9%E7%94%A8%E7%BB%8F%E6%B5%8E-transaction-fees/</guid>
      <description>&lt;p&gt;注：本文参考了Vitalik Buterin&lt;a href=&#34;https://vitalik.ca/files/Transaction%20fee%20economics.pdf&#34;&gt;关于交易费的演讲&lt;/a&gt;的思路和内容。&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;公共资源困境&#34;&gt;公共资源困境&lt;/h1&gt;
&lt;p&gt;1968年，美国学者哈定（Garrett Hardin）发表了著名的文章&lt;a href=&#34;http://science.sciencemag.org/content/sci/162/3859/1243.full.pdf&#34;&gt;《公地悲剧》(&amp;ldquo;The Tragedy of the Commons&amp;rdquo;)&lt;/a&gt;。他用博弈理论讲述了这样一个故事（引用Wikipedia中关于&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E5%85%AC%E5%9C%B0%E6%82%B2%E5%8A%87&#34;&gt;公地悲剧的介绍&lt;/a&gt;）：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;公共草地上，有一群牧羊人，每一個牧羊人都想要多獲利一些，所以某個牧羊人就帶了大量的羊來放牧，雖然他知道過度放牧，草地可能會承受不住。但他依然獲利了，而後所有的牧羊人都跟進，所以草地牧草耗竭，悲劇因而發生了。
&amp;hellip;
他举出一个牧羊人与牧场资源的假设性例子以解释他的论点：牧羊人应该极大化他的牧场，并且尽可能的增加他的羊群。而每增加一头羊，皆会带来正面与负面的影响：&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;正面：牧羊人可以从增加的羊只上获得所有的利润
负面：牧场的承载力因为额外增加的羊只有所耗损&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;然而，牧场理论的关键性在于这两者的代价并非平等：牧羊人获得所有的利益，但是资源的亏损却是转嫁到所有牧羊人的身上。因此，就理性观点考量，每一位牧羊人势必会衡量如此的效用，进而增加一头头的羊只。但是当所有的牧羊人皆做出如此的结论，并且无限制的放牧时，牧场负载力的耗损将是必然的后果。于是每一个个体依照理性反应所做出的决定将会相同，毕竟获得的利益将永远大于利益的耗损。而无限制的放牧所导致的损失便是外部性的一个例子。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;由于这样的个体行为是可预见的，并且将持续发生，因此Hardin称之为“悲剧”：“持续进行，永无休止的悲剧”。从哈丁的假设出发，可以发现追求自我利益的行动并不会促进公共利益。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Hardin如是说：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;“Ruin is the destination toward which all men rush, each pursuing his own best interest in a society that believes in the freedom of the commons. Freedom in a commons brings ruin to all.”
（&amp;ldquo;当所有人都相信公地（资源）是自由的，而不断地为个人利益最大化而争抢资源时，毁灭是我们的终点。资源的自由带来的是毁灭。&amp;quot;）&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;究其原因，是个体不受限制地根据自身利益最大化原则使用公有资源时会产生负的外部性。个体的经济活动忽视了总体社会成本的提高，因此它对整个社会的影响就不再是零和游戏。所以，对公众无限制地开放公有资源造成的会是对资源的滥用。要解决这个公地悲剧，我们必须要想办法抵销使用区块资源时所产生的负的外部性的影响。&lt;/p&gt;
&lt;h1 id=&#34;交易费的历史&#34;&gt;交易费的历史&lt;/h1&gt;
&lt;p&gt;中本聪是第一个考虑在区块链上加入一个交易费用的人。2008年底James Donald在质疑比特币的经济模型时提出，比特币要解决的一个经济问题是通胀，然而在一个p2p记帐网络中如果不解决记帐的费用来源问题，网络是没有经济模型能够自主运行起来的。但是如果记帐的费用是由挖矿（seigniorage）来支付的话，整个系统又会需要有通胀。从宏观角度来看，比特币网络的运转需要内在的刺激。于是中本聪提出了在网络中增加用户&lt;a href=&#34;https://satoshi.nakamotoinstitute.org/emails/cryptography/9/&#34;&gt;向挖矿者提供转帐费用的激励&lt;/a&gt;来解决这个问题。中本聪认为，在比特币网络分发了足够多的比特币之后，网络会完全由交易费用维持，并能够保持无通胀地运行。&lt;/p&gt;
&lt;p&gt;交易费除了可以激励经济体自我运转，它的另外一个作用是防止经济攻击。从微观的角度来看，增加支付交易费使得每个用户使用区块链资源的成本从极低上升到不可忽视，进而限制了用户影响公共资源的能力。于是，恶意用户试图通过大量占用公共资源进行denial-of-service攻击的成本也就大大提高了。比如说，最近NEO网络就受到了垃圾攻击(spam attack)的影响。为了激励用户使用，NEO规定&amp;rdquo;&lt;a href=&#34;http://docs.neo.org/zh-cn/sc/systemfees.html&#34;&gt;目前转账交易没有手续费（每个区块仅限21个交易）。&amp;hellip;每个智能合约在每次执行过程中有10 GAS 的免费额度&amp;hellip;&lt;/a&gt;&amp;quot;。于是，&lt;a href=&#34;https://neonewstoday.com/general/neo-blockchain-experiences-transaction-spam-attack/&#34;&gt;这个经济模型漏洞就被人利用了&lt;/a&gt;，迫使&lt;a href=&#34;https://medium.com/neo-smart-economy/annocements-about-attack-transactions-in-neo-9fd7409fb3c6&#34;&gt;NEO委员会不得不提出改变交易手续费规则&lt;/a&gt;。再比如说，如果矿工收不到手续费，他们就可能不愿意去打包传进来的交易请求。这使得矿工会随意产出不带交易的块，甚至放入无意义的交易充斥区块空间。也就是说，交易费既能够吸引矿工节点参与网络建设，又能够防止他们对网络进行攻击。&lt;/p&gt;
&lt;p&gt;当一笔交易被矿工记录在由矿工生成的区块上之后，这笔交易会被广播至全网的其它节点。于是我们发现，虽然全网的节点都承担了记录交易的责任，但是只是挖出区块的矿工获得了交易的手续费。不仅如此，不但这笔被记录了的交易增加了节点当下的存储负担，它也增加了节点将来的存储负担&amp;ndash;节点要永久保存这个记录。甚至，新加入的节点也需要承担这个记录的责任。也就是说，每一笔交易对全网节点的现在和将来都产生了交易之外的社会成本，而这个成本并没有被价格所展现。&lt;/p&gt;
&lt;h1 id=&#34;限额交易和庇古税&#34;&gt;限额交易和庇古税&lt;/h1&gt;
&lt;p&gt;在发现这个问题之后，Vitalik很自然地提出了一个经济学问题：对于每笔交易所产生的外部性（未承担的社会成本），如何使之内部化？即如何让这个交易产生的额外社会成本变成私人的成本，使内外的影响达到平衡？要解决将未考虑的额外社会的成本加入系统中来的问题，可以有两种实现方式。&lt;/p&gt;
&lt;p&gt;第一种方法是限额交易（cap-and-trade）。即给区块链的资源使用设一个上限，让资源活消耗的增加跟上软硬件基础设施性能的增长。在现实世界中，实施的办法就是规定难度自动调整，约每10分钟产生一个新块，每个块的大小不超过1MB。&lt;/p&gt;
&lt;p&gt;第二种方法是引入庇古税（Pigouvian Tax）。庇古税解决外部性的方法是对产生外部性主体的经济行为征税。在区块链的上下文里，交易手续费即是一种庇古税。但是，仅向矿工支付交易手续费并不是一个很好的税制，甚至谈不上是庇古税：首先交易费没有损耗，矿工可以和交易者合谋，产生新的经济攻击方式（我们会在下一篇文章里讨论）；其次，交易费的受益者只有矿工一个人，还缺少一个调节全网成本的机制。&lt;/p&gt;
</description>
    </item>
    
    
    
    <item>
      <title>Binary Translator</title>
      <link>https://alanli.org/binary-translator/</link>
      <pubDate>Fri, 03 Jun 2016 23:19:31 -0800</pubDate>
      
      <guid>https://alanli.org/binary-translator/</guid>
      <description>&lt;p&gt;（本文是对知乎问题&lt;a href=&#34;https://www.zhihu.com/question/29851229/answer/104193305&#34;&gt;二进制翻译( binary translation )有没有成熟的现实应用？请介绍一下实现方式与性能瓶颈&lt;/a&gt;的回复）&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;简介&#34;&gt;简介&lt;/h1&gt;
&lt;p&gt;Binary Translation是一个非常大的课题，如果要说得详细了可以写一本书。在这里我们仅仅讨论它的皮毛，也仅仅是大致勾画出二进制翻译器的运行结构。解释有错误的地方还请各位斧正。&lt;/p&gt;
&lt;p&gt;二进制翻译器在业界已然有不少产品使用了，这里只是简单介绍几个。BT之中最著名的可能是Qemu了。还有大家手中各式各样的游戏机模拟器也属于BT，其中，Dolphin模拟器是最成熟的，现在最新的Dolphin已不再是解释执行模拟器了，它已然加入了JIT优化。Intel曾开发过在X86 Android上运行ARM Android app的Houdini，但似乎由于性能问题已不再投入。在中国，计算所胡伟武他们正在做龙芯支持X86的工作（Zhang et al.
HERMES: A Fast Cross-ISA Binary
Translator with Post-Optimization, CGO&#39;15），也相当不错。&lt;/p&gt;
&lt;p&gt;系统地讲，现有的virtual machine在三个层次上：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;机器层面，比如游戏机模拟器&lt;/li&gt;
&lt;li&gt;系统层面，比如X86 Macintosh运行Power架构的Mac app&lt;/li&gt;
&lt;li&gt;应用层面，比如JVM&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;一般来说需要Binary translation（以下简称BT）的地方是guest代码与host机器架构不同的时候（也可以是相同的架构，但那样的翻译大多出于安全或优化而言的，如著名HP Dynamo：Bala et al. Dynamo: A Transparent Dynamic Optimization System PLDI&#39;2000）。&lt;/p&gt;
&lt;h1 id=&#34;原理&#34;&gt;原理&lt;/h1&gt;
&lt;p&gt;下面说说常用的二进制转换的方法和需要注意的问题。BT在执行的过程中需要不做任何假定地考虑：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;冯诺依曼结构计算机的数据和指令不分家，BT如何在执行的过程中区分哪些是数据，哪些是指令呢？&lt;/li&gt;
&lt;li&gt;对会自我修改自我引用的的程序如何处理？&lt;/li&gt;
&lt;li&gt;如何处理间接跳转语句？&lt;/li&gt;
&lt;li&gt;等等等等（一时半会想不起来）&amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;二进制转换分两种，一种是静态转换，另一种是动态转换（JIT）。静态转换就是将guest machine的二进制可执行代码翻译成host machine的可执行代码，动态转换就是边执行边翻译。对于静态转换来说，由于没有运行时信息，一个不可能解决的问题是在编译时如何知道间接跳转的目标地址。如果需要完美地转换，一个解决办法是自带一个解释器，当程序跳转到未被翻译指令处时，就启动解释器引擎。当然，这样其实还是需要即时转换的; 另一个办法比较极端，因为我们不知道哪些地址是指令，哪些是数据，我们只能假定所有地址都可以是指令来转换。如果是特定用途的BT，不一定需要这么严格的要求。&lt;/p&gt;
&lt;p&gt;对于动态转换来说，翻译间接跳转成为了可能。由于JIT的特性，对自我修改的程序也能够处理了。以一个动态Binary Translator来说，一种实现方式的伪代码是这样的：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;程序执行流交给BT，BT获得跳转目标地址或入口地址(设名字为tgt)&lt;/li&gt;
&lt;li&gt;BT以tgt所指指令为起始收集接下来的每一条指令，直到找到需要翻译的一段guest指令块&lt;/li&gt;
&lt;li&gt;BT对在第2步获得的block分析，优化，生成host代码
&lt;ul&gt;
&lt;li&gt;对每一条跳转语句，如果目标地址next_tgt已经被转译则更改跳转地址至已转译地址&lt;/li&gt;
&lt;li&gt;如果next_tgt未被转译过，则对该跳转语句生成返回第1步的函数调用，并tgt=next_tgt&lt;/li&gt;
&lt;li&gt;对间接跳转，同样生成一段返回BT的调用。BT查表得到next_tgt之后跳转至第1步&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;BT将生成的block代码段登记在自己系统里&lt;/li&gt;
&lt;li&gt;跳转到生成的host代码执行&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;在第二步收集的指令块的方式决定了指令块的结构，同时也决定了第3步能做哪些优化。通常要求生成的指令块是一个super basic block。SBB与basic block不同的地方在于SBB允许指令流在SBB的中间跳转出去，但因为它和BB一样入口唯一中间没有跳转，仍然保持了块内各指令间的依赖关系，故适合做小范围的优化。
当发现程序有自我修改的行为的时候，BT需要将被改写的指令块重新转译。通常做法是在被改写的指令块头插入跳转语句转入新生成的指令块。BT还需要同时修改guest code，以防止自引用的代码出错。&lt;/p&gt;
&lt;h1 id=&#34;性能与优化&#34;&gt;性能与优化&lt;/h1&gt;
&lt;p&gt;不要指望BT的性能会非常好，毕竟它是在跑一个虚拟机。一个naïvely写成的BT要是有host machine的四分之一性能就算很不错了。经过优化后，一般可以达到三分之一。Bansal et al.号称他们用super-optimization可以达到平均三分之二的性能（Binary Translation Using Peephole Superoptimizers OSDI&#39;08）。&lt;/p&gt;
&lt;p&gt;BT的一个重要优化是用 Shadow Stack来预测返回指令的跳转地址，这是BT overhead的一个非常大的一块。注意到返回指令虽然是一条间接指令，通常是要用runtime helper来查表搜索跳转地址的，开销非常大。注意到程序运行时的call stack通常都保存得很完整，每一个函数结束时返回的地址通常都是caller的下一条指令。利用这一个稳定的性质，我们可以用一个缓存栈保存程序调用栈的返回地址。那么下一次转译的返回指令就不需要再用helper查找跳转地址了。&lt;/p&gt;
&lt;p&gt;原理如下：
对每个call jump指令，在跳转的同时向ShadowStack这个BT维护的栈中压入一个二元组，元素分别为guest的返回地址和host的返回地址（guestPC+1, hostPC+1）。&lt;/p&gt;
&lt;p&gt;对每个return jump指令，查找SS栈顶的二元组。如果guestPC+1正好是返回地址寄存器RA的值，直接跳转到hostPC+1; 否则弹出SS栈顶搜索下一个。如果超过一定次数或者SS栈为空则跳转到helper查表。&lt;/p&gt;
&lt;p&gt;针对不同的guest architecture还可以进行如下的性能优化（仅举例）：
像ARM这样的指令集带有PC relative load，即类似ld r1,10(pc)，可以简化。但要考虑程序的自我修改。&lt;/p&gt;
&lt;p&gt;ARM指令都可以以零成本生成一个算术运算结果的status flag，即NZCV flags，用于比较判断。如果host是像龙芯MIPS这样自身不具有状态寄存器的架构，维护NZCV的开销可以算大头，需要将不需要的状态计算删除。&lt;/p&gt;
&lt;p&gt;如果host machine的寄存器数量低于guest machine（如X86模拟ARM），还需要做合理的register mapping，减少不必要的context switching开销。&lt;/p&gt;
&lt;p&gt;至于其余的代码生成优化，大家可以看上文提到的几篇paper。&amp;ldquo;Virtual Machines: Versatile Platforms for Systems and Processes&amp;quot;这本书也是很好的资料。&lt;/p&gt;
</description>
    </item>
    
    
    
    
  </channel>
</rss>
